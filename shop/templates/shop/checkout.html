{% extends 'shop/base.html' %}

{% block title %}ØªÚ©Ù…ÛŒÙ„ Ø®Ø±ÛŒØ¯ - ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†{% endblock %}

{% block content %}
<style>
    .checkout-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
    }
    .checkout-steps {
        display: flex;
        justify-content: space-between;
        margin-bottom: 40px;
        position: relative;
    }
    .checkout-steps::before {
        content: '';
        position: absolute;
        top: 20px;
        left: 0;
        right: 0;
        height: 2px;
        background: #ddd;
        z-index: 1;
    }
    .step {
        text-align: center;
        position: relative;
        z-index: 2;
        flex: 1;
    }
    .step-number {
        width: 40px;
        height: 40px;
        background: #ddd;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 10px;
        font-weight: bold;
    }
    .step.active .step-number {
        background: #2ecc71;
    }
    .step.completed .step-number {
        background: #27ae60;
    }
    .step-title {
        font-size: 0.9rem;
        color: #666;
    }
    .checkout-grid {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 30px;
    }
    @media (max-width: 768px) {
        .checkout-grid {
            grid-template-columns: 1fr;
        }
    }
    .order-summary {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        position: sticky;
        top: 20px;
    }
    .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
    }
    .summary-total {
        font-size: 1.3rem;
        font-weight: bold;
        color: #2c3e50;
        margin-top: 15px;
    }
    .payment-methods {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }
    .payment-method {
        border: 2px solid #ddd;
        border-radius: 10px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.3s;
        text-align: center;
    }
    .payment-method:hover {
        border-color: #3498db;
        background: #f8f9fa;
    }
    .payment-method.selected {
        border-color: #2ecc71;
        background: #f0f9f4;
    }
    .btn-pay {
        width: 100%;
        padding: 15px;
        background: #2ecc71;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 20px;
        transition: all 0.3s;
    }
    .btn-pay:hover {
        background: #27ae60;
        transform: translateY(-2px);
    }
</style>

<div class="checkout-container">
    <!-- Ù…Ø±Ø§Ø­Ù„ Ø®Ø±ÛŒØ¯ -->
    <div class="checkout-steps">
        <div class="step completed">
            <div class="step-number">Û±</div>
            <div class="step-title">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</div>
        </div>
        <div class="step active">
            <div class="step-number">Û²</div>
            <div class="step-title">Ù†Ø­ÙˆÙ‡ Ù¾Ø±Ø¯Ø§Ø®Øª</div>
        </div>
        <div class="step">
            <div class="step-number">Û³</div>
            <div class="step-title">ØªÚ©Ù…ÛŒÙ„ Ø®Ø±ÛŒØ¯</div>
        </div>
    </div>
    
    <h1 style="color: #2c3e50; margin-bottom: 30px;">ğŸ’³ ØªÚ©Ù…ÛŒÙ„ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø®Ø±ÛŒØ¯</h1>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="checkout-grid">
            <!-- ÙØ±Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª -->
            <div>
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px;">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“¦ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø±Ø³Ø§Ù„</h3>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div>
                            <label>Ù†Ø§Ù…:</label>
                            <input type="text" name="first_name" required 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</label>
                            <input type="text" name="last_name" required 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <label>Ø¢Ø¯Ø±Ø³ Ú©Ø§Ù…Ù„:</label>
                        <textarea name="address" rows="3" required 
                                  style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label>Ø´Ù‡Ø±:</label>
                            <input type="text" name="city" required 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                        <div>
                            <label>Ú©Ø¯ Ù¾Ø³ØªÛŒ:</label>
                            <input type="text" name="postal_code" required 
                                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
                        </div>
                    </div>
                </div>
                
                <!-- Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª -->
                <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: #2c3e50; margin-bottom: 20px;">ğŸ’³ Ø§Ù†ØªØ®Ø§Ø¨ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª</h3>
                    
                    <div class="payment-methods">
                        <div class="payment-method selected" onclick="selectPayment('zarinpal')">
                            <div style="font-size: 24px;">ğŸ’³</div>
                            <strong>Ø¯Ø±Ú¯Ø§Ù‡ Ø²Ø±ÛŒÙ†â€ŒÙ¾Ø§Ù„</strong>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 5px;">Ù¾Ø±Ø¯Ø§Ø®Øª Ø¢Ù†Ù„Ø§ÛŒÙ†</p>
                        </div>
                        
                        <div class="payment-method" onclick="selectPayment('card')">
                            <div style="font-size: 24px;">ğŸ¦</div>
                            <strong>Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª</strong>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 5px;">Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª: Û¶Û±Û°Û´-XXXX-XXXX-Û±Û²Û³Û´</p>
                        </div>
                        
                        <div class="payment-method" onclick="selectPayment('cash')">
                            <div style="font-size: 24px;">ğŸ’°</div>
                            <strong>Ù¾Ø±Ø¯Ø§Ø®Øª Ø¯Ø± Ù…Ø­Ù„</strong>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 5px;">ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªÙ‡Ø±Ø§Ù†</p>
                        </div>
                    </div>
                    
                    <input type="hidden" id="payment_method" name="payment_method" value="zarinpal">
                </div>
            </div>
            
            <!-- Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´ -->
            <div class="order-summary">
                <h3 style="color: #2c3e50; margin-bottom: 20px;">ğŸ“‹ Ø®Ù„Ø§ØµÙ‡ Ø³ÙØ§Ø±Ø´</h3>
                
                {% if cart.items.all %}
                    {% for item in cart.items.all %}
                    <div class="summary-item">
                        <div>
                            <strong>{{ item.product.name }}</strong>
                            <p style="color: #666; font-size: 0.9rem; margin-top: 5px;">
                                {{ item.quantity }} Ã— {{ item.product.price|floatformat:"0" }} ØªÙˆÙ…Ø§Ù†
                            </p>
                        </div>
                        <div style="font-weight: bold;">{{ item.total_price|floatformat:"0" }} ØªÙˆÙ…Ø§Ù†</div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #888; text-align: center; padding: 20px;">Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ø´Ù…Ø§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª</p>
                {% endif %}
                
                <div class="summary-item">
                    <div>Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ø±Ø³Ø§Ù„:</div>
                    <div>{% if cart.total_price > 100000 %}Ø±Ø§ÛŒÚ¯Ø§Ù†{% else %}Û±Ûµ,Û°Û°Û° ØªÙˆÙ…Ø§Ù†{% endif %}</div>
                </div>
                
                <div class="summary-item" style="border-bottom: none;">
                    <div>ØªØ®ÙÛŒÙ:</div>
                    <div style="color: #2ecc71;">Û° ØªÙˆÙ…Ø§Ù†</div>
                </div>
                
                <div class="summary-item summary-total">
                    <div>Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª:</div>
                    <div>
                        {% if cart.total_price > 100000 %}
                            {{ cart.total_price|floatformat:"0" }} ØªÙˆÙ…Ø§Ù†
                        {% else %}
                            {{ cart.total_price|add:"15000"|floatformat:"0" }} ØªÙˆÙ…Ø§Ù†
                        {% endif %}
                    </div>
                </div>
                
                <button type="submit" class="btn-pay">
                    Ù¾Ø±Ø¯Ø§Ø®Øª Ùˆ Ø«Ø¨Øª Ù†Ù‡Ø§ÛŒÛŒ Ø³ÙØ§Ø±Ø´
                </button>
                
                <p style="color: #666; font-size: 0.9rem; margin-top: 15px; text-align: center;">
                    Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø¨Ø± Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù¾Ø±Ø¯Ø§Ø®ØªØŒ 
                    <a href="#" style="color: #3498db;">Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ø´Ø±Ø§ÛŒØ·</a> Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒØ¯.
                </p>
            </div>
        </div>
    </form>
</div>

<script>
    let selectedPayment = 'zarinpal';
    
    function selectPayment(method) {
        selectedPayment = method;
        document.getElementById('payment_method').value = method;
        
        // Ø­Ø°Ù Ø§Ù†ØªØ®Ø§Ø¨ Ù‚Ø¨Ù„ÛŒ
        document.querySelectorAll('.payment-method').forEach(el => {
            el.classList.remove('selected');
        });
        
        // Ø§Ù†ØªØ®Ø§Ø¨ Ø¬Ø¯ÛŒØ¯
        event.currentTarget.classList.add('selected');
    }
</script>
{% endblock %}