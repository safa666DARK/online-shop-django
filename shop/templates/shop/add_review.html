{% extends 'shop/base.html' %}

{% block title %}ثبت نظر - {{ product.name }}{% endblock %}

{% block content %}
<style>
    .review-container {
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
    }
    .review-card {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .product-info {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
    }
    .rating-stars {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        direction: ltr;
    }
    .star {
        font-size: 40px;
        color: #ddd;
        cursor: pointer;
        transition: all 0.2s;
    }
    .star:hover,
    .star.active {
        color: #f39c12;
        transform: scale(1.1);
    }
</style>

<div class="review-container">
    <div class="review-card">
        <div class="product-info">
            <div style="font-size: 40px;">⭐</div>
            <div>
                <h2 style="color: #2c3e50; margin-bottom: 5px;">{{ product.name }}</h2>
                <p style="color: #666;">برای ثبت نظر خود درباره این محصول، از ۱ تا ۵ ستاره انتخاب کنید</p>
            </div>
        </div>
        
        <form method="post">
            {% csrf_token %}
            
            <!-- نمایش نظر قبلی اگر وجود دارد -->
            {% if existing_review %}
            <div style="background: #e8f4fd; padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                <p style="color: #3498db; margin: 0;">
                    ⚠️ شما قبلاً برای این محصول نظر داده‌اید. نظر جدید جایگزین خواهد شد.
                </p>
            </div>
            {% endif %}
            
            <!-- انتخاب امتیاز -->
            <div style="margin-bottom: 30px;">
                <label style="display: block; margin-bottom: 15px; font-weight: bold; color: #2c3e50;">
                    امتیاز شما:
                </label>
                
                <div class="rating-stars" id="ratingStars">
                    <span class="star" data-value="5">★</span>
                    <span class="star" data-value="4">★</span>
                    <span class="star" data-value="3">★</span>
                    <span class="star" data-value="2">★</span>
                    <span class="star" data-value="1">★</span>
                </div>
                
                <input type="hidden" name="rating" id="ratingValue" 
                       value="{% if existing_review %}{{ existing_review.rating }}{% else %}5{% endif %}">
                
                <div style="text-align: center; margin-top: 10px;">
                    <span id="ratingText" style="color: #f39c12; font-weight: bold;">
                        {% if existing_review %}
                            {{ existing_review.get_rating_display }}
                        {% else %}
                            ★★★★★ عالی
                        {% endif %}
                    </span>
                </div>
            </div>
            
            <!-- متن نظر -->
            <div style="margin-bottom: 30px;">
                <label style="display: block; margin-bottom: 10px; font-weight: bold; color: #2c3e50;">
                    نظر شما:
                </label>
                <textarea name="comment" rows="5" 
                          style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 10px; font-family: inherit;"
                          placeholder="نظر خود درباره این محصول را بنویسید...">{% if existing_review %}{{ existing_review.comment }}{% endif %}</textarea>
            </div>
            
            <!-- دکمه‌ها -->
            <div style="display: flex; gap: 15px;">
                <a href="{% url 'shop:product_detail' product.id %}" 
                   style="flex: 1; background: #f8f9fa; color: #333; padding: 12px; border-radius: 10px; text-decoration: none; text-align: center; border: 1px solid #ddd;">
                   انصراف
                </a>
                
                <button type="submit" 
                        style="flex: 1; background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;">
                    {% if existing_review %}
                        ویرایش نظر
                    {% else %}
                        ثبت نظر
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.star');
    const ratingValue = document.getElementById('ratingValue');
    const ratingText = document.getElementById('ratingText');
    
    // متناظر امتیاز با متن
    const ratingTexts = {
        1: '★☆☆☆☆ ضعیف',
        2: '★★☆☆☆ متوسط',
        3: '★★★☆☆ خوب', 
        4: '★★★★☆ بسیار خوب',
        5: '★★★★★ عالی'
    };
    
    // مقدار اولیه
    const initialRating = parseInt(ratingValue.value);
    highlightStars(initialRating);
    
    // رویداد کلیک روی ستاره‌ها
    stars.forEach(star => {
        star.addEventListener('click', function() {
            const value = parseInt(this.getAttribute('data-value'));
            ratingValue.value = value;
            ratingText.textContent = ratingTexts[value];
            highlightStars(value);
        });
    });
    
    // تابع برای هایلایت کردن ستاره‌ها
    function highlightStars(rating) {
        stars.forEach(star => {
            const value = parseInt(star.getAttribute('data-value'));
            if (value <= rating) {
                star.classList.add('active');
            } else {
                star.classList.remove('active');
            }
        });
    }
});
</script>
{% endblock %}