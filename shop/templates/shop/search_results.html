{% extends 'shop/base.html' %}

{% block title %}Ø¬Ø³ØªØ¬ÙˆÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª{% endblock %}

{% block content %}
<style>
    .search-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    .search-header {
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        color: white;
        padding: 30px;
        border-radius: 20px;
        margin-bottom: 30px;
    }
    .search-filters {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        margin-bottom: 30px;
    }
    .filter-section {
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
    }
    .filter-title {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.1rem;
    }
    .price-slider {
        padding: 0 10px;
    }
    .price-inputs {
        display: flex;
        gap: 15px;
        margin-top: 15px;
    }
    .price-input {
        flex: 1;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 8px;
    }
    .filter-btn {
        background: #2ecc71;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 10px;
        font-weight: bold;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
    }
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
    }
    @media (max-width: 768px) {
        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        }
    }
</style>

<div class="search-container">
    <!-- Ù‡Ø¯Ø± Ø¬Ø³ØªØ¬Ùˆ -->
    <div class="search-header">
        <h1>ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</h1>
        <form method="get" action="{% url 'shop:search' %}" style="margin-top: 20px;">
            <div style="display: flex; gap: 10px;">
                <input type="text" name="q" value="{{ query }}" 
                       placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ ÛŒØ§ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ..." 
                       style="flex: 1; padding: 12px 15px; border-radius: 10px; border: none;">
                <button type="submit" 
                        style="background: white; color: #4361ee; border: none; padding: 12px 25px; border-radius: 10px; font-weight: bold;">
                    Ø¬Ø³ØªØ¬Ùˆ
                </button>
            </div>
        </form>
    </div>
    
    <div style="display: grid; grid-template-columns: 280px 1fr; gap: 30px;">
        <!-- Ø³Ø§ÛŒØ¯Ø¨Ø§Ø± ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
        <div class="search-filters">
            <form method="get" id="filterForm">
                <input type="hidden" name="q" value="{{ query }}">
                
                <!-- ÙÛŒÙ„ØªØ± Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ -->
                <div class="filter-section">
                    <div class="filter-title">ğŸ“‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</div>
                    <select name="category" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>
                        {% for category in categories %}
                        <option value="{{ category.id }}" {% if selected_category == category.id|stringformat:"i" %}selected{% endif %}>
                            {{ category.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                
                <!-- ÙÛŒÙ„ØªØ± Ù‚ÛŒÙ…Øª -->
                <div class="filter-section">
                    <div class="filter-title">ğŸ’° Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù‚ÛŒÙ…Øª (ØªÙˆÙ…Ø§Ù†)</div>
                    <div class="price-inputs">
                        <input type="number" name="min_price" placeholder="Ø­Ø¯Ø§Ù‚Ù„" 
                               value="{{ min_price }}" class="price-input">
                        <input type="number" name="max_price" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±" 
                               value="{{ max_price }}" class="price-input">
                    </div>
                </div>
                
                <!-- ÙÛŒÙ„ØªØ± Ù…ÙˆØ¬ÙˆØ¯ÛŒ -->
                <div class="filter-section">
                    <div class="filter-title">ğŸ“¦ Ù…ÙˆØ¬ÙˆØ¯ÛŒ</div>
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" name="in_stock" value="true" 
                               {% if in_stock %}checked{% endif %} style="width: 18px; height: 18px;">
                        ÙÙ‚Ø· Ú©Ø§Ù„Ø§Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
                    </label>
                </div>
                
                <!-- Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ -->
                <div class="filter-section">
                    <div class="filter-title">ğŸ“Š Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³</div>
                    <select name="sort_by" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                        <option value="newest" {% if selected_sort == 'newest' %}selected{% endif %}>Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                        <option value="price_asc" {% if selected_sort == 'price_asc' %}selected{% endif %}>Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
                        <option value="price_desc" {% if selected_sort == 'price_desc' %}selected{% endif %}>Ú¯Ø±Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
                    </select>
                </div>
                
                <button type="submit" class="filter-btn">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§</button>
                
                <!-- Ø±ÛŒØ³Øª ÙÛŒÙ„ØªØ±Ù‡Ø§ -->
                <a href="{% url 'shop:search' %}" 
                   style="display: block; text-align: center; margin-top: 15px; color: #e74c3c;">
                   Ø­Ø°Ù Ù‡Ù…Ù‡ ÙÛŒÙ„ØªØ±Ù‡Ø§
                </a>
            </form>
        </div>
        
        <!-- Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ -->
        <div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #2c3e50;">
                    {% if query %}
                    Ù†ØªØ§ÛŒØ¬ Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø±Ø§ÛŒ "{{ query }}"
                    {% else %}
                    Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª
                    {% endif %}
                </h2>
                <div style="color: #666;">
                    {{ products.count }} Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ø´Ø¯
                </div>
            </div>
            
            {% if products %}
            <div class="products-grid">
                {% for product in products %}
                <div class="product-card">
                    <h4 style="color: #2c3e50; margin-bottom: 10px; font-size: 1.1rem;">{{ product.name }}</h4>
                    <p style="color: #666; font-size: 0.9rem; margin-bottom: 15px;">{{ product.description|truncatewords:12 }}</p>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="color: #2ecc71; font-weight: bold; font-size: 1.1rem;">{{ product.price|floatformat:"0" }} ØªÙˆÙ…Ø§Ù†</span>
                        <small style="color: #888;">Ø¯Ø³ØªÙ‡: {{ product.category.name }}</small>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <a href="{% url 'shop:product_detail' product.id %}" 
                           style="flex: 1; background: #f8f9fa; color: #4361ee; text-align: center; padding: 8px; border-radius: 8px; text-decoration: none; font-size: 0.9rem;">
                            Ù…Ø´Ø§Ù‡Ø¯Ù‡
                        </a>
                        <a href="{% url 'shop:add_to_cart' product.id %}" 
                           style="flex: 1; background: #2ecc71; color: white; text-align: center; padding: 8px; border-radius: 8px; text-decoration: none; font-size: 0.9rem;">
                            ğŸ›’ Ø®Ø±ÛŒØ¯
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 60px 20px;">
                <div style="font-size: 60px; color: #ddd; margin-bottom: 20px;">ğŸ”</div>
                <h3 style="color: #666; margin-bottom: 15px;">Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h3>
                <p style="color: #888;">Ø¨Ø§ ØªØºÛŒÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø¨Ø§ ØªØºÛŒÛŒØ± select
    document.querySelectorAll('select, input[type="checkbox"]').forEach(element => {
        element.addEventListener('change', function() {
            document.getElementById('filterForm').submit();
        });
    });
});
</script>
{% endblock %}